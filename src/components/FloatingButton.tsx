import React, { useState, memo } from 'react';
import { DetectedIOC } from '@/types/ioc';

interface FloatingButtonProps {
  position: { top: number; left: number };
  iocs: DetectedIOC[];
  onAnalyze: () => void;
  onClose?: () => void;
}

/**
 * Floating Button Component
 * Metin seçildiğinde görünen analiz butonu - Medium gibi hover efekti
 * OPTIMIZED: Memoized to prevent unnecessary re-renders
 */
const FloatingButton: React.FC<FloatingButtonProps> = memo(({
  position,
  iocs,
  onAnalyze,
}) => {
  const [isHovered, setIsHovered] = useState(false);

  return (
    <div
      className="ahtapot-floating-button"
      style={{
        top: `${position.top}px`,
        left: `${position.left}px`,
      }}
    >
      <button
        onClick={onAnalyze}
        onMouseEnter={() => setIsHovered(true)}
        onMouseLeave={() => setIsHovered(false)}
        className={isHovered ? 'expanded' : ''}
        title={`${iocs.length} IOC tespit edildi`}
        aria-label={`${iocs.length} güvenlik göstergesi tespit edildi. Analiz etmek için tıklayın.`}
      >
        <svg
          className="ahtapot-logo"
          viewBox="0 0 101 88"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fillRule="evenodd"
            clipRule="evenodd"
            d="M45.9983 0.29966C38.7121 1.5999 32.4513 6.01643 28.5787 12.5881C27.4465 14.5093 26.6423 16.5261 25.9806 19.1032C25.4533 21.1559 25.4214 21.5483 25.3499 26.8362L25.2747 32.4069L29.4637 34.8075C31.7678 36.1282 33.7188 37.2357 33.7993 37.2688C33.8801 37.3021 33.9871 34.0328 34.0373 30.0037C34.1197 23.3986 34.1697 22.5276 34.5464 21.1461C35.4552 17.8122 36.9189 15.3796 39.4065 13.0694C41.2953 11.3151 43.4092 10.1214 45.9983 9.34684C48.5095 8.59552 52.0782 8.54305 54.4766 9.22213C60.1513 10.8291 64.4153 14.9855 66.1123 20.5649C66.5681 22.0635 66.5718 22.1743 66.6941 38.3184C66.8144 54.1947 66.8271 54.6021 67.2603 56.2519C67.7955 58.2901 69.1661 61.0119 70.476 62.6374C73.9737 66.9777 79.882 69.4591 85.2172 68.8285C88.9557 68.3865 92.3071 66.8582 94.9789 64.3768C97.4106 62.1184 98.7342 59.9918 99.7286 56.7447C100.213 55.1629 100.273 54.6455 100.273 52.0412C100.273 49.4288 100.214 48.9221 99.7223 47.3159C98.3353 42.7847 95.1743 39.0441 91.021 37.0189C88.2307 35.6584 87.079 35.4089 83.5448 35.3998C81.4063 35.3944 80.3806 35.4699 80.0532 35.6565C79.5903 35.9205 79.5895 35.9292 79.6198 40.2981C79.6364 42.7056 79.686 44.7346 79.7302 44.8073C79.7742 44.8799 80.2417 44.7768 80.7692 44.5782C84.6926 43.1004 89.092 44.9423 90.8823 48.8123C91.5406 50.235 91.7154 52.8432 91.2562 54.389C89.8801 59.0217 84.451 61.4054 80.0865 59.2933C78.6454 58.5959 77.1312 57.0672 76.3605 55.5316L75.6722 54.1602L75.5525 37.9148C75.4218 20.1711 75.4622 20.7858 74.1782 16.9543C73.1586 13.9121 71.8884 11.6599 69.628 8.88592C65.9557 4.37978 59.9188 1.00255 54.0861 0.191491C51.964 -0.10355 47.9572 -0.0500702 45.9983 0.29966ZM42.3121 22.0397C39.7468 22.9698 38.6959 25.8183 40.0482 28.1758C41.741 31.1266 46.0786 30.8646 47.5333 27.7235C48.0385 26.6326 48.0072 25.5043 47.438 24.2928C46.8804 23.1062 46.5094 22.7432 45.2882 22.1894C44.2788 21.7317 43.2976 21.6823 42.3121 22.0397ZM55.7154 22.0659C53.3617 22.9046 52.2522 25.8104 53.4323 28.045C54.7888 30.6138 58.4185 31.012 60.3126 28.7998C62.1314 26.6756 61.4566 23.4259 58.9551 22.2614C57.7776 21.7133 56.8599 21.658 55.7154 22.0659ZM14.104 35.4356C11.5528 35.7881 8.16556 37.3001 6.08798 39.0134C3.51786 41.1326 1.53174 44.1104 0.550683 47.3159C0.0589449 48.9221 0 49.4288 0 52.0412C0 54.6455 0.0597527 55.1629 0.544426 56.7447C1.5388 59.9918 2.86242 62.1184 5.29406 64.3768C7.96591 66.8582 11.3172 68.3865 15.0557 68.8285C20.3946 69.4595 26.2783 66.9872 29.8089 62.629C30.8214 61.3792 32.7206 57.7602 32.8201 56.891C32.872 56.4388 32.5345 56.2029 29.1427 54.3196C27.0888 53.179 25.3074 52.2452 25.184 52.2444C25.0607 52.2436 24.9052 52.7041 24.8384 53.2676C24.5909 55.3563 23.0475 57.8189 21.2848 58.9369C20.0757 59.704 18.0564 60.3165 16.7575 60.3104C14.4415 60.2993 12.5902 59.523 10.9178 57.8613C6.32295 53.2962 8.47017 45.6708 14.8052 44.0541C16.5772 43.6021 18.2755 43.7912 20.2931 44.6652C21.9171 45.3687 26.1834 47.7199 29.0158 49.472C29.9183 50.0304 32.1416 51.3944 33.9568 52.5033L37.2566 54.5194L37.9948 54.138C40.438 52.8755 45.7187 49.9469 45.8057 49.8064C45.8624 49.7146 45.0207 49.1184 43.9349 48.4817C42.8492 47.8448 39.9626 46.0578 37.5201 44.5104C25.6689 37.0024 21.6435 35.2382 16.5546 35.3215C15.5398 35.3381 14.437 35.3894 14.104 35.4356ZM62.1373 44.9626C61.9132 45.1806 60.3138 46.07 56.798 47.9316C49.5933 51.7466 47.2329 53.0282 45.3927 54.1251C39.3722 57.7136 36.5039 60.5266 34.7923 64.5207C33.659 67.1656 33.4808 68.1143 33.4979 71.4146C33.5121 74.1354 33.5577 74.4754 34.1492 76.258C36.9068 84.5686 45.1995 89.3911 53.728 87.6439C63.4704 85.648 69.4495 75.0259 66.0766 65.7067C65.3741 63.766 64.0329 61.4097 62.9176 60.156L62.1473 59.2905L61.5214 59.6515C59.0948 61.051 54.5575 63.817 54.4786 63.9446C54.4259 64.0297 54.7325 64.3419 55.1601 64.6382C56.1787 65.3439 57.1 66.5087 57.7701 67.9383C58.2504 68.9625 58.3119 69.3352 58.3119 71.217C58.3119 73.1972 58.2685 73.4284 57.6674 74.6478C55.5981 78.8453 50.7637 80.6059 46.7048 78.6403C44.8759 77.7546 43.301 76.1096 42.5672 74.3188C41.8119 72.4745 41.7681 70.0998 42.4568 68.3181C43.5986 65.3643 45.8816 63.6739 56.459 57.9511C58.9928 56.5804 61.4229 55.2336 61.8589 54.9583L62.652 54.4578V52.979C62.652 52.1657 62.7117 49.9874 62.7846 48.1383C62.8979 45.2676 62.8742 44.7762 62.6231 44.7762C62.4614 44.7762 62.2426 44.8601 62.1373 44.9626Z"
            fill="currentColor"
          />
        </svg>
        <span className="button-text">Analiz Et</span>
        {iocs.length > 1 && (
          <span className="ahtapot-ioc-badge" aria-label={`${iocs.length} IOC`}>
            {iocs.length}
          </span>
        )}
      </button>
    </div>
  );
});

FloatingButton.displayName = 'FloatingButton';

export default FloatingButton;
